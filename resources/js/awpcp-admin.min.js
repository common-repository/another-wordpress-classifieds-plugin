AWPCP.define("awpcp/settings-validator",["jquery","awpcp/jquery-validate-methods"],function(r){function e(){}return r.extend(e.prototype,{setup:function(e){var n=this,i={rules:{},messages:{}};e.find("[awpcp-setting]").each(function(){var e=r(this),t=e.attr("name"),a=JSON.parse(e.attr("awpcp-setting"));a&&a.validation&&a.validation.messages&&(i.messages[t]=a.validation.messages),a&&a.validation&&a.validation.rules&&(i.rules[t]=n.getSettingRules(a)),n.setupSettingBehavior(e,a)}),e.validate(r.extend(i,{errorClass:"invalid",errorPlacement:function(e,t){e.addClass("awpcp-message awpcp-error").css("display","block"),t.closest("td").append(e)}}))},getSettingRules:function(e){var t,a={};for(t in e.validation.rules)e.validation.rules.hasOwnProperty(t)&&(a[t]=this.getRuleForValidator(t,e));return a},getRuleForValidator:function(e,t){var t=t.validation.rules[e],a=this.getEscapedSelector(t.depends);return 0===r(a).length?t:r.extend({},t,{depends:function(){return r(a).is(":checked")}})},getEscapedSelector:function(e){var t=this;return void 0!==e&&r.map(e.split(","),function(e){return"#"+t.escapeSelector(e)}).join(",")},escapeSelector:function(e){return e.trim().replace(/(:|\.|\[|\]|,)/g,"\\$1")},getEscapedNameSelector:function(e){var t=this;return r.map(e.split(","),function(e){return'[name="awpcp-options['+t.escapeSelector(e)+']"]'}).join(",")},setupSettingBehavior:function(e,t){var a,n=this;for(a in t.behavior)t.behavior.hasOwnProperty(a)&&r.isFunction(n[a])&&n[a].apply(n,[e,t.behavior[a]])},enabledIf:function(e,t){var a=r(this.getEscapedSelector(t));a.change(function(){a.is(":checked")?e.prop("disabled",!1):e.prop("disabled",!0)}),a.change()},shownUnless:function(e,t){var a=r(this.getEscapedSelector(t));a.change(function(){a.is(":checked")?e.closest("tr").fadeOut(400):e.closest("tr").fadeIn(400)}),a.change()},enabledIfMatches:function(e,t){var t=t.split("="),a=t[0],n=t[1],i=r(this.getEscapedNameSelector(a));i.change(function(){i.filter(":checked").val()===n?e.prop("disabled",!1):e.prop("disabled",!0)}),i.change()}}),new e});